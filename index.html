<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Href Game Starter</title>
  <style>
    :root {
      --bg: #0f1115; --panel:#161a22; --muted:#8892a6; --text:#e6edf3; --accent:#6be675;
    }
    html, body { height: 100%; }
    body {
      margin: 0; font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      color: var(--text); background: radial-gradient(1000px 500px at 20% -10%, #1a2030, transparent), var(--bg);
      display: grid; place-items: center; padding: 24px;
    }
    .frame {
      width: min(900px, 92vw); min-height: 70vh; background: var(--panel);
      border: 1px solid #262c3a; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,.35);
      display: grid; grid-template-rows: auto 1fr auto; overflow: hidden;
    }
    header, footer { padding: 14px 18px; background:#131722; color: var(--muted); }
    header { display:flex; gap:10px; align-items:center; justify-content:space-between; }
    .title { font-weight:700; color: var(--text); }
    .stats { font-size: 14px; display:flex; gap:18px; align-items:center; }
    main { padding: 22px 24px; }
    .passage { white-space: pre-wrap; margin: 0 0 16px 0; }
    .choices { display: grid; gap: 8px; }
    .choices a {
      color: var(--accent); text-decoration: none; border-bottom: 1px dashed color-mix(in oklab, var(--accent) 60%, transparent);
      width: fit-content;
    }
    .choices a:hover { text-decoration: underline; }
    .badge { font-size: 12px; padding:2px 8px; border:1px solid #2a3347; border-radius: 999px; color: var(--muted); }
    .inv { display:flex; gap:6px; flex-wrap: wrap; }
    .kbd { font: 12px/1.2 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas; background:#0c0f16; border:1px solid #2a3347; border-radius:6px; padding:2px 6px; color:#cbd5e1; }
    .hint { color: var(--muted); font-size: 14px; margin-top: 8px; }
    .phone {
      width: min(460px, 96%);
      margin: 16px auto;
      background:#0c0f16;
      border:1px solid #2a3347;
      border-radius: 20px;
      box-shadow: 0 12px 36px rgba(0,0,0,.45);
      overflow: hidden;
      color:#e6edf3;
    }
    .phone .statusbar {
      padding: 10px 14px;
      font: 14px/1.2 ui-monospace, SFMono-Regular, Menlo, Consolas;
      color:#94a3b8;
      border-bottom:1px solid #1f2636;
      display:flex; justify-content:space-between; align-items:center;
    }
    .phone .caller {
      display:flex; gap:14px; align-items:center; padding:16px;
    }
    .phone .caller img {
      width:56px; height:56px; border-radius:12px; object-fit:cover;
      border:1px solid #2a3347; background:#111522;
    }
    .phone .caller .name { font-weight:700; font-size:18px; }
    .phone .caller .sub  { color:#94a3b8; font-size:13px; margin-top:2px; }
    .call-buttons {
      display:flex; gap:12px; justify-content:center; padding:16px; border-top:1px solid #1f2636;
    }
    .btn {
      display:inline-block; padding:10px 16px; border-radius:999px; text-decoration:none;
      border:1px solid #2a3347; background:#131a2a; color:#e6edf3; font-weight:600;
    }
    .btn.green { background:#0b3; }
    .btn.red   { background:#b00; }
    .btn:hover { filter:brightness(1.05); }
  </style>
</head>
<body>
  <div class="frame">
    <header>
      <div class="title">I'm not giving up on you</div>
      <!-- <div class="stats">
        <span class="badge">Health: <span id="stat-health">3</span></span>
        <span class="badge">Coins: <span id="stat-coins">0</span></span>
        <span class="badge">Room: <span id="stat-room">â€”</span></span>
      </div> -->
    </header>

    <main>
      <div id="passage" class="passage"></div>
      <nav id="choices" class="choices"></nav>
      <!-- <div class="hint">Tip: You can link directly to a node, e.g. <span class="kbd">#dock</span> or <span class="kbd">#market</span>.</div> -->
    </main>

    <footer>
      <div class="inv" id="inventory"></div>
    </footer>
  </div>

  <script>
    // --- Minimal a-href interactive fiction engine ---
    // Each node has: id, text, links[], (optional) onEnter() side effects/conditions

    const state = {
      hour: 10,
      minute: 30,
      name: 'Irene'
    };

    const nodes = {
      // --- Starting node ----------------------------------------------------------
      start: {
        id: 'start',
        text: () => {
          return `Buzzzzz... Your alarm clock vibrates on the nightstand. The glowing digits read ${formatTime(state.hour, state.minute)}.`;
        },
        links: [
          { to: 'snoozeAlarm', label: 'Hit the snooze button' },
          { to: 'stopAlarm', label: 'Turn off the alarm' },
          { to: 'ignoreAlarm', label: 'Pull the blanket over your head' },
        ],
      },
    
      // --- Stop alarm -------------------------------------------------------------
    stopAlarm: {
      id: 'stopAlarm',
      text: () => {
      state.hour = 12;
    state.minute = 21;
      return `<p>You pass out after this majestic effort. Moments later, your phone begins to ring loudly.</p>
        <div class="phone">
          <div class="statusbar">
            <span>${formatTime(state.hour, state.minute)}</span>
            <span>ðŸ“¶ ðŸ”‹</span>
          </div>
          <div class="caller">
            <img src="Lily.png" alt="Lily">
            <div>
              <div class="name">Lily</div>
              <div class="sub">Incoming call</div>
            </div>
          </div>
          <div class="call-buttons">
            <a class="btn green" href="#takeCall">Pick up</a>
            <a class="btn red"   href="#rejectCall">Hang up</a>
          </div>
        </div>
      `},
      links: [],
    },

    takeCall: {
      id: 'takeCall',
      text: `
      You swipe to answer. "Dude WHAT THE HELL! You're supposed to be meeting me in the cafe 2 hours ago."
      "I'm sorry. I just need to focus on self-care today..."
      "You know I'm starting to grow sick of your therapy talk. I know you've been through a lot and I know we've always been best friends, but with this kind of disrespect I don't think I want to be friends with you anymore! Maybe I need to focus on MY self-care you know!"
      She hangs up. You sit in the dark in silence. You know you have to do something to salvage this mess. But you just don't have the energy for that.
      ...
      What a mess...`,
    links: [],
    },
        
    rejectCall: {
      id: 'rejectCall',
      text: `<p>You are too exhausted to answer the phone. But Lily won't </p>
        <div class="phone">
          <div class="statusbar">
            <span>${formatTime(state.hour, state.minute)}</span>
            <span>ðŸ“¶ ðŸ”‹</span>
          </div>
          <div class="caller">
            <img src="Lily.png" alt="Lily">
            <div>
              <div class="name">Lily</div>
              <div class="sub">Incoming call</div>
            </div>
          </div>
          <div class="call-buttons">
            <a class="btn green" href="#takeCall">Pick up</a>
            <a class="btn red"   href="#rejectCall">Hang up</a>
          </div>
        </div>
      `,
    links: [],
    },

    
      // --- Snooze sequence --------------------------------------------------------
      snoozeAlarm: {
        id: 'snoozeAlarm',
        text: () => {
          advanceTime(30);
          console.log(`DEBUG time ${state.hour}:${state.minute} (cutoff? ${isAtOrAfterHM(state.hour, state.minute, 7, 51)})`);
          return `Buzzzzz... Your alarm clock vibrates on the nightstand. The glowing digits read ${formatTime(state.hour, state.minute)}.`
        },
        links: [
          { to: () => {
              const next = peekAdvance(30); // what time it'll be after clicking snooze
              return isAtOrAfterHM(next.h, next.m, 12, 21) ? 'snoozeAlarmEnd' : 'snoozeAlarm';
            },
            label: 'Snooze again',
          },
          { to: 'stopAlarm', label: 'Turn off the alarm' },
          { to: 'ignoreAlarm', label: 'Pull the blanket over your head' },
        ],
      },
    
      // --- Ignore alarm -----------------------------------------------------------
      ignoreAlarm: {
        id: 'ignoreAlarm',
        text: () => {
      state.hour = 12;
    state.minute = 21;
      return `<p>Honestly, it's quite naive of your clock to think it can conquer your exhaustion with lovely music. Moments later, your phone begins to ring loudly.</p>
        <div class="phone">
          <div class="statusbar">
            <span>${formatTime(state.hour, state.minute)}</span>
            <span>ðŸ“¶ ðŸ”‹</span>
          </div>
          <div class="caller">
            <img src="Lily.png" alt="Lily">
            <div>
              <div class="name">Lily</div>
              <div class="sub">Incoming call</div>
            </div>
          </div>
          <div class="call-buttons">
            <a class="btn green" href="#takeCall">Pick up</a>
            <a class="btn red"   href="#rejectCall">Hang up</a>
          </div>
        </div>
      `},
        links: [],
      },
    
      // --- End of snooze ----------------------------------------------------------
      snoozeAlarmEnd: {
        id: 'snoozeAlarmEnd',
        text: () => {
      state.hour = 12;
    state.minute = 21;
      return `<p>Moments later, your phone begins to ring loudly.</p>
        <div class="phone">
          <div class="statusbar">
            <span>${formatTime(state.hour, state.minute)}</span>
            <span>ðŸ“¶ ðŸ”‹</span>
          </div>
          <div class="caller">
            <img src="Lily.png" alt="Lily">
            <div>
              <div class="name">Lily</div>
              <div class="sub">Incoming call</div>
            </div>
          </div>
          <div class="call-buttons">
            <a class="btn green" href="#takeCall">Pick up</a>
            <a class="btn red"   href="#rejectCall">Hang up</a>
          </div>
        </div>
      `},
        links: [],
      },

    unknownCaller: {
      id: 'unknownCaller',
      text: () => `
        <div class="phone">
          <div class="statusbar"><span>${formatTime(state.hour, state.minute)}</span><span>ðŸ“¶ ðŸ”‹</span></div>
          <div class="caller">
            <img src="./unknown.jpeg" alt="Unknown" style="filter: grayscale(100%);">
            <div>
              <div class="name">Unknown Caller</div>
              <div class="sub">Incoming call</div>
            </div>
          </div>
          <div class="call-buttons">
            <a class="btn green" href="#takeCall">Answer</a>
            <a class="btn red"   href="#rejectCall">Decline</a>
          </div>
        </div>
      `,
      links: [],
    },

        
    };


    // --- helper functions ---
    function formatTime(hour, minute) {
      const padded = minute.toString().padStart(2, '0');
      const suffix = hour >= 12 ? 'PM' : 'AM';
      const displayHour = (hour % 12) || 12;
      return `${displayHour}:${padded} ${suffix}`;
    }

    function advanceTime(minutesToAdd) {
      state.minute += minutesToAdd;
      while (state.minute >= 60) {
        state.minute -= 60;
        state.hour += 1;
      }
      if (state.hour >= 24) state.hour -= 24; // keep it in 24-hour format
    }

    // function isBefore(h, m) {
    //   return state.hour < h || (state.hour === h && state.minute < m);
    // }

    // function isAtOrAfter(h, m) {
    //   return !isBefore(h, m);
    // }

    function peekAdvance(minutes) {
      let h = state.hour, m = state.minute;
      m += minutes;
      while (m >= 60) { m -= 60; h += 1; }
      if (h >= 24) h -= 24;
      return { h, m };
    }
    
    function isAtOrAfterHM(h, m, H, M) {
      return h > H || (h === H && m >= M);
    }

    function enableClickToContinue(nextId) {
      const el = document.getElementById('passage');
      el.style.cursor = 'pointer';
      el.title = 'Click to continue';
      el.addEventListener('click', () => {
        el.style.cursor = 'auto';
        location.hash = '#' + nextId;
      }, { once: true }); // ensure it only fires once
    }



    // --- tiny engine ---
    const $ = (id) => document.getElementById(id);

    function render() {
      // optional: update header badges if youâ€™re showing any
    }
    
    function resolve(nodeId) {
      const n = nodes[nodeId];
      if (!n) return;
      state.current = n;
    
      // Compute and show text
      const text = (typeof n.text === 'function') ? n.text() : n.text;
      document.getElementById('passage').innerHTML = text;
    
      // Render links (NOTE: function-valued link.to is evaluated here)
      const html = (n.links || [])
        .map(link => {
          const target = (typeof link.to === 'function') ? link.to() : link.to;
          return `<a href="#${target}">${link.label}</a>`;
        })
        .join('<br/>');
      document.getElementById('choices').innerHTML = html;

    if (n.id === 'takeCall') {
        enableClickToContinue('unknownCaller');
      }
    }
    
    window.addEventListener('hashchange', () => {
      const id = location.hash.slice(1) || 'start';
      resolve(id);
    });
    
    // Re-render even if clicking the same node (lets snooze on #snoozeAlarm loop)
    document.getElementById('choices').addEventListener('click', (e) => {
      const a = e.target.closest('a[href^="#"]');
      if (!a) return;
      e.preventDefault();
      const target = a.getAttribute('href').slice(1);
      if (state.current?.id === target) {
        resolve(target);                  // force re-render for same-hash clicks
      } else {
        location.hash = '#' + target;     // normal navigation
      }
    });
    
    // Boot
    if (!location.hash) location.hash = '#start';
    resolve(location.hash.slice(1));

  </script>
</body>
</html>
